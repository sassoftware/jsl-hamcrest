<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Mock.jsl</title><link rel="stylesheet" type="text/css" href="../../styles/main.css" /><script type="text/javascript" src="../../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.0.2 -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="Globals"></a><a name="Topic256"></a><div class="CTopic TSection LJSL first">
 <div class="CTitle">Globals</div>
</div>

<a name="Functions"></a><a name="Topic257"></a><div class="CTopic TGroup LJSL">
 <div class="CTitle">Functions</div>
</div>

<a name="ut_mock_function"></a><a name="Topic258"></a><div class="CTopic TFunction LJSL">
 <div class="CTitle">ut mock function</div>
 <div id="NDPrototype258" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters">ut mock <span class="SHKeyword">function</span>(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PNamePrefix first">{</td><td class="PName last">args},</td></tr><tr><td class="PNamePrefix first">&lt;{</td><td class="PName last">locals}&gt;,</td></tr><tr><td class="first"></td><td class="PName last">Expr(body)&nbsp;</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Used to test expectations on callbacks and the like.</p><p>Creates a mock function that creates a function from the pieces provided and decorates it.&nbsp; Returns an object (called obj in this document) with the decorated function accessible via obj:fn.&nbsp; You can then use ut expect call(obj, ...) with a list of matchers to set expectations. You should call this once for each time you expect your function to be called. This should be done before the calls to your function. As your function is called, these expectations are checked one by one. Then, after you test body is over, call ut verify mock(obj). This will make sure you got the correct number of calls.</p><p>Note, it is /extremely/ important that you ensure that ut verify mock is called. Otherwise, your test will <b>silently pass</b> even if you didn't get all the calls you expected. The easiest way to ensure this is to call it in the Teardown of a ut test case.</p><p>Users of other mock frameworks may notice that this is a little more than a mock since we are instrumenting an arbitrary function. However, this was the easiest way to supply both the signature and return to the ut mock function factory. And it gives us some extra flexibility. So hopefully you'll forgive me stretching the definition. Also, it doesn't have the capability (yet) to change the body of the function for each expectation. However, this is something I hope to add.</p><p>Another difference from other mock frameworks is that this verifies the expectations eagerly in the instrumented function. This is useful when the arguments may not live past the callback call and they can not be cloned. One common example of this is Display Boxes.</p><p>Use obj:fn(...) to call the instrumented function. And use obj:orig fn(...) to call the uninstrumented function.</p><p>When calling ut mock function, you can omit the locals list if desired.</p><div class="CHeading">Arguments</div><table class="CDefinitionList"><tr><td class="CDLEntry">args</td><td class="CDLDefinition"><p>args list</p></td></tr><tr><td class="CDLEntry">locals</td><td class="CDLDefinition"><p>locals list</p></td></tr><tr><td class="CDLEntry">body</td><td class="CDLDefinition"><p>an expression using args and locals</p></td></tr></table><div class="CHeading">Example</div><pre>Button Box Test = ut test <span class="SHKeyword">case</span>(<span class="SHString">&quot;Button Box&quot;</span>)<br />    &lt;&lt; Setup(Expr(mock = ut mock <span class="SHKeyword">function</span>({<span class="SHKeyword">this</span>}, Expr(.))))<br />    &lt;&lt; Teardown(Expr(ut verify mock(mock)));<br />ut test(Button Box Test, <span class="SHString">&quot;Calls Callback&quot;</span>, Expr(<br />    ut expect call(mock, {ut enabled(<span class="SHNumber">1</span>)});<br />    New Window(<span class="SHString">&quot;&quot;</span>, btn = Button Box(<span class="SHString">&quot;Hi&quot;</span>, &lt;&lt; Set Function(Function({<span class="SHKeyword">this</span>}, mock:fn(<span class="SHKeyword">this</span>)))));<br />    btn &lt;&lt; Click;<br />));</pre></div>
</div>

<a name="ut_expect_call"></a><a name="Topic259"></a><div class="CTopic TFunction LJSL">
 <div class="CTitle">ut expect call</div>
 <div id="NDPrototype259" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters">ut expect call(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="first"></td><td class="PName last">mock,</td></tr><tr><td class="PNamePrefix first">{</td><td class="PName last">arg1 matcher, arg2 matcher, ...}&nbsp;</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Use with ut mock function to define expectations for mocked functions.</p><p>Must be given a list of values or matchers. These represent a single call to the mock function.&nbsp; They are appended to a list of expectations and matched when the mock function has been called the appropriate number of times. If the number of matchers doesn't match or any matcher fails, the call expectation fails.</p><p>This is a function to avoid class member lookup rules and enable syntax highlighting and Scripting Index help.</p><div class="CHeading">Arguments</div><table class="CDefinitionList"><tr><td class="CDLEntry">mock</td><td class="CDLDefinition"><p>any mock</p></td></tr><tr><td class="CDLEntry">call</td><td class="CDLDefinition"><p>list of matchers</p></td></tr></table></div>
</div>

<a name="ut_verify_mock"></a><a name="Topic260"></a><div class="CTopic TFunction LJSL last">
 <div class="CTitle">ut verify mock</div>
 <div id="NDPrototype260" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters">ut verify mock(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PName first last">mock&nbsp;</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Use with ut mock function to test that a mock function has been called the expected number of times.</p><p>If this function is not called, you will only be testing that the calls (actually done) to the mock match the expectations and that there were at least as many expectations as calls. But you won't catch the case where the mock isn't called enough times. For instance, you wouldn't catch the common failure case of NO calls to the mock even though you had expected some. Be sure to call this function for all your mocks.</p><p>This is a function rather than a message so we get syntax highlighting and Scripting Index help.</p><div class="CHeading">Arguments</div><table class="CDefinitionList"><tr><td class="CDLEntry">mock</td><td class="CDLDefinition"><p>any mock</p></td></tr></table></div>
</div>

</body></html>